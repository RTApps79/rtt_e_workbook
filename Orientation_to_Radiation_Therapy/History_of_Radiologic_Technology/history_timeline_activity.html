<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity: Radiologic History Timeline Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Feedback styles consistent with other updated lessons */
        .feedback.correct { color: #16a34a; /* Tailwind green-600 */ font-weight: bold; }
        .feedback.incorrect { color: #dc2626; /* Tailwind red-600 */ font-weight: bold; }
        .question-item.correct-item { border-left: 4px solid #22c55e !important; background-color: #f0fdf4 !important; }
        .question-item.incorrect-item { border-left: 4px solid #ef4444 !important; background-color: #fef2f2 !important; }


        /* Badge Area - Blue/Teal Theme for Awards */
        #badge-section { margin-top: 30px; padding: 20px; background-color: #fff; border: 1px solid #ccc; text-align: center; display: none; }
        #badge-input input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .badge {
            width: 350px; height: 250px; border: 10px solid #0056b3; /* Blue border */
            background-color: #e7f3ff; /* Light Blue background */
            margin: 20px auto; padding: 30px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
            font-family: 'Georgia', serif; text-align: center;
        }
        .badge h4 { color: #003d7a; font-size: 1.5em; margin: 0; } /* Darker Blue title */
        .badge .awardee { font-size: 1.3em; font-weight: bold; color: #17a2b8; /* Teal name */
            margin: 15px 0; border-bottom: 1px dashed #17a2b8; padding-bottom: 5px; }
        .badge .reason { font-size: 1.1em; margin: 10px 0; }
        .badge .score { font-size: 1em; font-style: italic; color: #555; }
        .badge .logo { font-size: 0.8em; margin-top: 15px; font-weight: bold; color: #0056b3; } /* Blue logo */

        /* Print Styles */
        @media print {
            body { background-color: #fff !important; color: #000 !important; padding-bottom: 0 !important; font-size: 10pt; }
            .main-content-wrapper { box-shadow: none !important; border: none !important; width: 100% !important; max-width: 100% !important; padding: 5px !important; margin:0 !important;}
            .nav-links-header, .post-activity-nav, #start-screen-activity button, #timeline-activity-area button, footer, #badge-input button:not(#printBadgeButton), #activity-results button  { display: none !important; }
            h1, h2, h3, h4 { color: #000 !important; border-color: #000 !important; margin-bottom: 10px; padding-bottom: 3px;}
            a {text-decoration: none; color: #000 !important;}
            
            #badge-section, #badge-section * { visibility: visible; }
            .badge { visibility: visible; position: absolute; left: 0; top: 0; width: 90%; height: auto; margin: 5%; padding: 20px; box-shadow: none; border: 5px solid #000 !important; color: #000 !important; background: #fff !important; }
            .badge h4, .badge .awardee, .badge .logo, .badge .reason, .badge .score { color: #000 !important; text-shadow: none;}
            .badge .awardee { border-bottom: 1px dashed #000 !important; }
             #start-screen-activity, #timeline-activity-area form, #activity-results > p:not(#activity-score) { display: none !important; }
             #activity-score { visibility: hidden !important; /* Hide score display from print view of badge */ }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex flex-col min-h-screen">

    <header class="bg-white shadow-md sticky top-0 z-50 nav-links-header">
        <div class="container mx-auto px-6 py-3 flex flex-col sm:flex-row justify-between items-center">
            <h1 class="text-xl font-bold text-purple-700 mb-2 sm:mb-0">Radiologic History Timeline Challenge</h1>
            <div class="flex flex-wrap justify-center sm:justify-end space-x-2">
                <a href="history_of_rad_tech_lesson.html#lesson-page-6" class="text-xs sm:text-sm bg-purple-500 text-white font-medium py-2 px-3 rounded-lg hover:bg-purple-600 transition-colors duration-300 mb-1 sm:mb-0">
                    &larr; Back to History Lesson
                </a>
                <a href="index.html" class="text-xs sm:text-sm bg-slate-500 text-white font-medium py-2 px-3 rounded-lg hover:bg-slate-600 transition-colors duration-300 mb-1 sm:mb-0">
                    &larr; Back to Orientation Menu
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto max-w-4xl px-4 sm:px-6 py-8 flex-grow main-content-wrapper">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-xl">
            <h1 class="text-3xl font-bold text-purple-700 mb-6 text-center border-b-2 border-purple-300 pb-4">Activity: Radiologic History Timeline Challenge ‚è≥</h1>

            <div id="start-screen-activity" class="bg-purple-50 p-4 sm:p-6 rounded-lg shadow-md mb-8 border border-purple-200">
                <h2 class="text-2xl font-semibold text-purple-600 mb-4">Match the Milestone!</h2>
                <div class="mb-4 p-3 bg-purple-100 rounded-md border border-purple-200">
                    <h3 class="text-lg font-medium text-purple-700 mb-1">Purpose</h3>
                    <p class="text-sm text-slate-600">This activity will help you solidify your understanding of the key discoveries and advancements in the early history of radiologic technology.</p>
                </div>
                <div class="mb-4 p-3 bg-purple-100 rounded-md border border-purple-200">
                    <h3 class="text-lg font-medium text-purple-700 mb-1">Task</h3>
                    <p class="text-sm text-slate-600">For each historical event or discovery listed, select the correct corresponding pioneer or approximate time period from the dropdown menu. After making all your selections, click "Check Answers" to see your score.</p>
                </div>
                <div class="p-3 bg-purple-100 rounded-md border border-purple-200">
                    <h3 class="text-lg font-medium text-purple-700 mb-1">Criteria for Success</h3>
                    <p class="text-sm text-slate-600">Accuracy in matching the events to their correct associations is key. A score of <strong class="text-purple-700">80% or higher</strong> will earn you a "History Buff Award" badge!</p>
                </div>
                <button id="start-activity-btn" onclick="startActivity()" class="mt-6 bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-5 rounded-lg text-base transition-colors duration-150 block mx-auto">Start Timeline Challenge</button>
            </div>

            <div id="timeline-activity-area" style="display: none;" class="bg-purple-50 p-4 sm:p-6 rounded-lg shadow-md border border-purple-200">
                <h2 class="text-2xl font-semibold text-purple-600 mb-4 text-center">Match Events to Timeline</h2>
                <form id="timeline-quiz-form">
                    </form>
                <button type="button" onclick="checkTimelineAnswers()" class="block mx-auto mt-6 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg text-base transition-colors">Check Answers</button>
                <div id="activity-results" class="mt-6 text-center">
                    <p id="activity-score" class="text-xl font-semibold text-purple-700"></p>
                </div>
            </div>

            <div id="badge-section" class="mt-8">
                <h3 class="text-xl font-semibold text-purple-700 mb-4 text-center">Congratulations! You've Earned an Award!</h3>
                <div id="badge-input" class="text-center mb-4">
                    <label for="userNameForBadge" class="block text-sm font-medium text-slate-700 mb-1">Enter Your Name:</label>
                    <input type="text" id="userNameForBadge" placeholder="Your Name Here" class="mt-1 inline-block max-w-xs px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
                    <button onclick="generateBadge()" class="ml-2 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors">Generate Badge</button>
                </div>
                <div class="badge" id="printableBadge" style="display:none;">
                    <h4>History Buff Award</h4>
                    <p class="awardee" id="badgeName"></p>
                    <p class="reason">For excellent knowledge of key milestones in Radiologic History.</p>
                    <p class="score" id="badgeScore"></p>
                    <p class="logo">RTApps Learning</p>
                </div>
                <button id="printBadgeButton" onclick="window.print()" style="display:none;" class="block mx-auto mt-4 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition-colors">Print Badge</button>
            </div>

            <div class="post-activity-nav" id="end-nav" style="display: none;">
                <h3 class="text-xl font-semibold text-slate-700 mb-4">What's Next?</h3>
                <button class="menu" onclick="window.location.href='index.html'">Back to Orientation Menu</button> 
                <button class="repeat" onclick="window.location.reload()">Try Again</button>
                <button onclick="window.location.href='history_of_rad_tech_lesson.html#lesson-page-6'">Back to History Lesson</button>
            </div>
        </div>
    </main>

    <footer class="bg-slate-800 text-slate-300 py-6 mt-auto text-center">
        <div class="container mx-auto px-6">
            <p class="text-sm">&copy; <span id="currentYear"></span> RTApps. All Rights Reserved.</p>
            <p class="text-xs mt-1">Radiologic History Timeline Challenge</p>
        </div>
    </footer>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        const timelineEvents = [
            { event: "Discovery of X-rays", answer: "Wilhelm Roentgen (1895)", options: ["Wilhelm Roentgen (1895)", "Marie Curie (1898)", "Henri Becquerel (1896)", "Early 1900s"] },
            { event: "Discovery of natural radioactivity", answer: "Henri Becquerel (1896)", options: ["Wilhelm Roentgen (1895)", "Marie Curie (1898)", "Henri Becquerel (1896)", "1922"] },
            { event: "Isolation of Radium and Polonium", answer: "Marie & Pierre Curie (c. 1898)", options: ["Wilhelm Roentgen (1895)", "Marie & Pierre Curie (c. 1898)", "Early Radiologists", "1950s"] },
            { event: "First medical uses of X-rays for imaging bones", answer: "Late 1890s - Early 1900s", options: ["1895 only", "Late 1890s - Early 1900s", "1920s", "1940s"] },
            { event: "Formation of the American Registry of X-Ray Technicians (ARRT precursor)", answer: "1922", options: ["1896", "1901", "1922", "1935"] },
            { event: "Growing awareness of radiation hazards & 'martyrs of radiology'", answer: "Early 1900s", options: ["1895", "Early 1900s", "Mid 1900s", "Late 1900s"] }
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startActivity() {
            document.getElementById('start-screen-activity').style.display = 'none';
            document.getElementById('timeline-activity-area').style.display = 'block';
            document.getElementById('activity-results').style.display = 'none'; // Hide previous results
            document.getElementById('badge-section').style.display = 'none';
            document.getElementById('end-nav').style.display = 'none';
            populateTimelineQuiz();
        }

        function populateTimelineQuiz() {
            const form = document.getElementById('timeline-quiz-form');
            form.innerHTML = ''; 
            const localTimelineEvents = [...timelineEvents]; // Use a copy for shuffling per quiz instance
            shuffleArray(localTimelineEvents); 

            localTimelineEvents.forEach((item, index) => {
                const questionId = `event_${index}`;
                let optionsHtml = `<option value="">Select correct match...</option>`;
                const shuffledOptions = [...item.options].sort(() => 0.5 - Math.random());
                shuffledOptions.forEach(opt => {
                    optionsHtml += `<option value="${opt}">${opt}</option>`;
                });

                form.innerHTML += `
                    <div class="question-item p-4 mb-4 bg-slate-50 rounded-lg border border-slate-200" id="q-item-${index}">
                        <p class="font-medium text-slate-700 mb-2">${index + 1}. ${item.event}</p>
                        <select id="${questionId}" name="${questionId}" class="mt-1 block w-full sm:w-auto max-w-xs px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
                            ${optionsHtml}
                        </select>
                        <div class="feedback mt-2 text-sm" id="feedback-${index}"></div>
                    </div>
                `;
            });
        }

        function checkTimelineAnswers() {
            let score = 0;
            // Note: timelineEvents is used here, which is the original order if populateTimelineQuiz shuffles a copy
            // This needs to be consistent. Let's ensure we check against the displayed (shuffled) order or store it.
            // For simplicity, the current populateTimelineQuiz uses the global `timelineEvents` after shuffling it.
            
            const form = document.getElementById('timeline-quiz-form');
            const questionItems = form.querySelectorAll('.question-item');


            timelineEvents.forEach((item, index) => { // Iterate based on the current order in the form
                const selectElement = document.getElementById(`event_${index}`);
                const feedbackElement = document.getElementById(`feedback-${index}`);
                const questionItemElement = document.getElementById(`q-item-${index}`);

                // To get the correct answer, we need to find the original item based on the event text,
                // as `timelineEvents` array might have been shuffled.
                // A better way: store the correct answer with the question when generating.
                // For now, let's find the original item by its event text for checking.
                const displayedEventText = questionItemElement.querySelector('p').textContent.substring(3).trim(); // Get event text, remove "X. "
                const originalItem = flashcardData.find(flashcardItem => flashcardItem.event === displayedEventText);


                if (selectElement && originalItem && selectElement.value === originalItem.answer) {
                    score++;
                    feedbackElement.textContent = "Correct!";
                    feedbackElement.className = "feedback text-green-600 font-semibold";
                    questionItemElement.classList.add('correct-item');
                    questionItemElement.classList.remove('incorrect-item');
                } else if (selectElement) {
                    feedbackElement.textContent = `Incorrect. Correct was: ${originalItem ? originalItem.answer : 'N/A'}`;
                    feedbackElement.className = "feedback text-red-600 font-semibold";
                    questionItemElement.classList.add('incorrect-item');
                    questionItemElement.classList.remove('correct-item');
                }
            });

            const percentage = Math.round((score / timelineEvents.length) * 100);
            document.getElementById('activity-score').textContent = `Your Score: ${score} out of ${timelineEvents.length} (${percentage}%)`;
            document.getElementById('activity-results').style.display = 'block';
            document.getElementById('end-nav').style.display = 'block';

            if (percentage >= 80) {
                document.getElementById('badge-section').style.display = 'block';
                window.finalScoreValue = percentage;
            } else {
                document.getElementById('badge-section').style.display = 'none';
            }
             // Disable check answers button after checking
            const checkButton = document.querySelector('#timeline-activity-area button[type="button"]');
            if(checkButton) checkButton.disabled = true;
        }
        // Correction for checkTimelineAnswers - use the item from the loop
         function checkTimelineAnswers_corrected() {
            let score = 0;
            timelineEvents.forEach((item, index) => { // timelineEvents is shuffled by populateTimelineQuiz
                const selectElement = document.getElementById(`event_${index}`);
                const feedbackElement = document.getElementById(`feedback-${index}`);
                const questionItemElement = document.getElementById(`q-item-${index}`);

                if (selectElement.value === item.answer) { // Check against the 'answer' of the currently displayed item
                    score++;
                    feedbackElement.textContent = "Correct!";
                    feedbackElement.className = "feedback correct"; // Use defined CSS classes
                    questionItemElement.classList.add('correct-item');
                    questionItemElement.classList.remove('incorrect-item');
                } else {
                    feedbackElement.textContent = `Incorrect. Correct was: ${item.answer}`;
                    feedbackElement.className = "feedback incorrect"; // Use defined CSS classes
                    questionItemElement.classList.add('incorrect-item');
                    questionItemElement.classList.remove('correct-item');
                }
            });
            // The rest of the function remains the same...
            const percentage = Math.round((score / timelineEvents.length) * 100);
            document.getElementById('activity-score').textContent = `Your Score: ${score} out of ${timelineEvents.length} (${percentage}%)`;
            document.getElementById('activity-results').style.display = 'block';
            document.getElementById('end-nav').style.display = 'block';

            if (percentage >= 80) {
                document.getElementById('badge-section').style.display = 'block';
                window.finalScoreValue = percentage;
            } else {
                document.getElementById('badge-section').style.display = 'none';
            }
            const checkButton = document.querySelector('#timeline-activity-area button[type="button"]');
            if(checkButton) checkButton.disabled = true;
        }
        // Use the corrected function
        function checkTimelineAnswers() {
            checkTimelineAnswers_corrected();
        }


        function generateBadge() {
            const name = document.getElementById('userNameForBadge').value;
            if (name.trim() === "") { alert("Please enter your name for the badge."); return; }
            document.getElementById('badgeName').textContent = name;
            document.getElementById('badgeScore').textContent = `Achieved with a score of ${window.finalScoreValue}%`;
            document.getElementById('printableBadge').style.display = 'flex';
            document.getElementById('printBadgeButton').style.display = 'inline-block';
        }
    </script>
</body>
</html>
