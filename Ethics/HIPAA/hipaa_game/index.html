<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity: Spot the Violation</title>
    <style>
           body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        margin: 0; padding: 0;
        background-color: #f4f4f4;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        position: relative;
        padding-bottom: 80px; /* Increased space for footer + nav */
    }
    .container {
        background-color: #fff;
        padding: 25px 35px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 800px;
        margin: 20px auto;
    }
    h1, h2, h3 { color: #0056b3; }
    h1 { text-align: center; border-bottom: 2px solid #0056b3; padding-bottom: 10px; }
    h2 { margin-top: 30px; color: #003d7a; }
    h3 { color: #004085; }
    p, li { margin-bottom: 12px; font-size: 1.05em; }
    ul { margin-bottom: 15px; padding-left: 25px; }
    button {
        background-color: #007bff; color: white; padding: 10px 20px;
        border: none; border-radius: 5px; cursor: pointer;
        font-size: 1em; margin: 5px; transition: background-color 0.2s;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }

    /* TILT Framework */
    .tilt-framework {
        background-color: #e7f3ff; border: 1px solid #b3d7ff;
        padding: 15px 25px; border-radius: 8px; margin-bottom: 30px;
    }
    .tilt-framework h3 { margin-top: 15px; border-bottom: 1px solid #b3d7ff; padding-bottom: 5px; }

    /* Footer */
    footer {
        position: absolute; bottom: 0; left: 0; width: 100%;
        text-align: center; padding: 15px 0; background-color: #e9ecef;
        color: #6c757d; font-size: 0.9em; border-top: 1px solid #dee2e6;
    }

    /* Post-Activity Navigation */
    .post-activity-nav {
        text-align: center; margin-top: 40px; padding: 20px;
        background-color: #f8f9fa; border-top: 1px solid #e9ecef; border-radius: 0 0 8px 8px;
    }
    .post-activity-nav button { margin: 5px 15px; }
    .post-activity-nav button.repeat { background-color: #28a745; }
    .post-activity-nav button.repeat:hover { background-color: #218838; }
    .post-activity-nav button.menu { background-color: #6c757d; }
    .post-activity-nav button.menu:hover { background-color: #5a6268; }

    /* Badge Area */
    #badge-section { margin-top: 30px; padding: 20px; background-color: #fff; border: 1px solid #ccc; text-align: center; display: none; }
    #badge-input input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .badge {
        width: 350px; height: 250px; border: 10px solid #0056b3;
        background-color: #e7f3ff; margin: 20px auto; padding: 30px;
        display: flex; flex-direction: column; justify-content: center;
        align-items: center; box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
        font-family: 'Georgia', serif; text-align: center;
    }
    .badge h4 { color: #003d7a; font-size: 1.5em; margin: 0; }
    .badge .awardee { font-size: 1.3em; font-weight: bold; color: #17a2b8; margin: 15px 0; border-bottom: 1px dashed #17a2b8; padding-bottom: 5px; }
    .badge .reason { font-size: 1.1em; margin: 10px 0; }
    .badge .score { font-size: 1em; font-style: italic; color: #555; }
    .badge .logo { font-size: 0.8em; margin-top: 15px; font-weight: bold; color: #0056b3; }

    /* Print Styles */
    @media print {
        body * { visibility: hidden; }
        #badge-section, #badge-section * { visibility: visible; }
        .badge {
           visibility: visible; position: absolute; left: 0; top: 0;
           width: 90%; height: auto; margin: 5%; padding: 20px;
           box-shadow: none; border: 5px solid #000;
           color: #000;
        }
        .badge h4, .badge .awardee, .badge .logo { color: #000; }
        .badge .awardee { border-bottom: 1px dashed #000; }
        #badge-input, .post-activity-nav, h1, h2, h3, .container > p, button:not(#printBadgeButton) { display: none; }
        footer { display: none; }
    } 
      /* Shared CSS (from above) goes here */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; display: flex; flex-direction: column; align-items: center; min-height: 100vh; position: relative; padding-bottom: 80px; }
        .container { background-color: #fff; padding: 25px 35px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 800px; margin: 20px auto; }
        h1, h2, h3 { color: #0056b3; }
        h1 { text-align: center; border-bottom: 2px solid #0056b3; padding-bottom: 10px; }
        h2 { margin-top: 30px; color: #003d7a; }
        h3 { color: #004085; }
        p, li { margin-bottom: 12px; font-size: 1.05em; }
        ul { margin-bottom: 15px; padding-left: 25px; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin: 5px; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .tilt-framework { background-color: #e7f3ff; border: 1px solid #b3d7ff; padding: 15px 25px; border-radius: 8px; margin-bottom: 30px; }
        .tilt-framework h3 { margin-top: 15px; border-bottom: 1px solid #b3d7ff; padding-bottom: 5px; }
        footer { position: absolute; bottom: 0; left: 0; width: 100%; text-align: center; padding: 15px 0; background-color: #e9ecef; color: #6c757d; font-size: 0.9em; border-top: 1px solid #dee2e6; }
        .post-activity-nav { text-align: center; margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #e9ecef; border-radius: 0 0 8px 8px; }
        .post-activity-nav button { margin: 5px 15px; }
        .post-activity-nav button.repeat { background-color: #28a745; }
        .post-activity-nav button.repeat:hover { background-color: #218838; }
        .post-activity-nav button.menu { background-color: #6c757d; }
        .post-activity-nav button.menu:hover { background-color: #5a6268; }
        #badge-section { margin-top: 30px; padding: 20px; background-color: #fff; border: 1px solid #ccc; text-align: center; display: none; }
        #badge-input input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .badge { width: 350px; height: 250px; border: 10px solid #0056b3; background-color: #e7f3ff; margin: 20px auto; padding: 30px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 3px 3px 8px rgba(0,0,0,0.2); font-family: 'Georgia', serif; text-align: center; }
        .badge h4 { color: #003d7a; font-size: 1.5em; margin: 0; }
        .badge .awardee { font-size: 1.3em; font-weight: bold; color: #17a2b8; margin: 15px 0; border-bottom: 1px dashed #17a2b8; padding-bottom: 5px; }
        .badge .reason { font-size: 1.1em; margin: 10px 0; }
        .badge .score { font-size: 1em; font-style: italic; color: #555; }
        .badge .logo { font-size: 0.8em; margin-top: 15px; font-weight: bold; color: #0056b3; }
        @media print { body * { visibility: hidden; } #badge-section, #badge-section * { visibility: visible; } .badge { visibility: visible; position: absolute; left: 0; top: 0; width: 90%; height: auto; margin: 5%; padding: 20px; box-shadow: none; border: 5px solid #000; color: #000; } .badge h4, .badge .awardee, .badge .logo { color: #000; } .badge .awardee { border-bottom: 1px dashed #000; } #badge-input, .post-activity-nav, h1, h2, h3, .container > p, button:not(#printBadgeButton), footer { display: none; } }

        /* Game Specific Styles */
        #game-area { border: 1px solid #ccc; padding: 20px; background-color: #f0f8ff; border-radius: 5px; min-height: 350px; position: relative; }
        .scenario { margin-bottom: 20px; padding: 15px; background-color: #fff; border: 1px solid #e0e0e0; border-radius: 5px; }
        .scenario-title { font-weight: bold; margin-bottom: 10px; color: #555; }
        .scenario .content { font-family: 'Courier New', Courier, monospace; line-height: 1.8; background-color: #fdfdfd; padding: 10px; border: 1px dashed #ddd; }
        .clickable { background-color: #fff3cd; padding: 1px 4px; border-radius: 3px; cursor: pointer; border: 1px solid #ffeeba; transition: background-color 0.2s, box-shadow 0.2s; }
        .clickable:hover, .clickable:focus { background-color: #ffe69c; box-shadow: 0 0 5px rgba(255, 204, 0, 0.5); outline: none; }
        .clickable.correct { background-color: #d4edda; border-color: #c3e6cb; cursor: default; font-weight: bold; }
        .clickable.incorrect { background-color: #f8d7da; border-color: #f5c6cb; cursor: default; text-decoration: line-through; }
        .clickable.disabled { cursor: default; opacity: 0.8; }
        .clickable.disabled:hover { background-color: #fff3cd; box-shadow: none; }
        .clickable.correct.disabled:hover { background-color: #d4edda; }
        .clickable.incorrect.disabled:hover { background-color: #f8d7da; }
        #feedback-box { margin-top: 15px; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; min-height: 2em; }
        .feedback-correct-msg { background-color: #e8f8f0; color: #1E8449; }
        .feedback-incorrect-msg { background-color: #fdedec; color: #A93226; }
        #score-board { font-size: 1.2em; font-weight: bold; text-align: right; color: #0056b3; margin-bottom: 10px; }
        #next-button { background-color: #28a745; display: block; margin: 20px auto 0 auto; }
        #next-button:hover { background-color: #218838; }
        #results-area { text-align: center; }
        .rubric-table { width: 100%; margin-top: 20px; border-collapse: collapse; text-align: left; }
        .rubric-table th, .rubric-table td { border: 1px solid #ddd; padding: 10px; }
        .rubric-table th { background-color: #0056b3; color: white; }
        .rubric-table tr:nth-child(even) { background-color: #f2f2f2; }
        .highlight-score { background-color: #ffc !important; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Activity: Spot the Violation</h1>
        <div id="game-area">
            <div id="score-board">Score: 0 / 0 | Violations: 0</div>
            <div id="scenario-container"></div>
            <div id="feedback-box"></div>
            <button id="next-button" onclick="loadNextScenario()" disabled>Start Game</button>
        </div>
        <div id="results-area" style="display: none;">
             <h2>Activity Results</h2>
             <p id="final-score"></p>
             <h3>Scoring Rubric</h3>
             <table class="rubric-table">
                <thead><tr><th>Score Range</th><th>Level</th><th>Description</th></tr></thead>
                <tbody>
                    <tr id="rubric-expert"><td>90-100%</td><td>Expert</td><td>Excellent identification of violations.</td></tr>
                    <tr id="rubric-proficient"><td>75-89%</td><td>Proficient</td><td>Good identification, minor errors.</td></tr>
                    <tr id="rubric-developing"><td>60-74%</td><td>Developing</td><td>Identifies obvious violations, needs review.</td></tr>
                    <tr id="rubric-novice"><td>Below 60%</td><td>Novice</td><td>Needs thorough review.</td></tr>
                </tbody>
             </table>
             <div id="badge-section">
                <h3>Congratulations! You've Earned a Badge!</h3>
                <div id="badge-input">
                    <label for="userNameForBadge">Enter Your Name:</label>
                    <input type="text" id="userNameForBadge" placeholder="Your Name Here">
                    <button onclick="generateBadge()">Generate Badge</button>
                </div>
                <div class="badge" id="printableBadge" style="display:none;">
                    <h4>HIPAA Awareness Award</h4>
                    <p class="awardee" id="badgeName"></p>
                    <p class="reason">For demonstrating proficiency in identifying potential HIPAA violations.</p>
                    <p class="score" id="badgeScore"></p>
                    <p class="logo">RTApps Learning</p>
                </div>
                <button id="printBadgeButton" onclick="window.print()" style="display:none;">Print Badge</button>
             </div>
        </div>
        <div class="post-activity-nav" id="end-nav" style="display: none;">
            <h3>What's Next?</h3>
            <button class="menu" onclick="window.location.href='https://rtapps79.github.io/rtt_e_workbook/Ethics/'">Back to Ethics Menu</button>
            <button class="repeat" onclick="window.location.reload()">Try Game Again</button>
            <button onclick="window.location.href='hipaa_lesson.html#lesson-page-10'">Other HIPAA Activities</button>
        </div>
    </div>
    <footer> <p>&copy; 2025 RTApps. All rights reserved.</p> </footer>

    <script>
        // Game JS (as before, but adapted)
        const scenarios = [ /* Add game scenarios here as in previous examples */
            { title: "Scenario 1: Facebook Post", content: `Rough day! Treated <span class="clickable" data-violation="true" data-feedback="PHI! Name/Initials.">Mr. S</span> with <span class="clickable" data-violation="true" data-feedback="PHI! Condition.">rare lung cancer</span> on <span class="clickable" data-violation="true" data-feedback="PHI! Location detail.">Linac 2</span>. <span class="clickable" data-violation="false" data-feedback="General, not PHI.">#RTTLife</span>`},
            { title: "Scenario 2: Text Message", content: `RTT1: <span class="clickable" data-violation="true" data-feedback="PHI! Identifiable person.">News anchor</span> in today! RTT2: <span class="clickable" data-violation="true" data-feedback="PHI! Asking condition.">For a brain?</span>`},
            { title: "Scenario 3: Internal Email", content: `<span class="clickable" data-violation="false" data-feedback="OK for TPO.">Move John P. (10/15/65)?</span> He needs <span class="clickable" data-violation="false" data-feedback="OK for TPO.">transport.</span>`},
            { title: "Scenario 4: Instagram Story", content: `(Image: Console with <span class="clickable" data-violation="true" data-feedback="PHI! Visible name/ID.">'Pat_Name: Sm_th, J'</span>) <span class="clickable" data-violation="false" data-feedback="General text.">Another day!</span>`},
            { title: "Scenario 5: WhatsApp Group", content: `Patient in <span class="clickable" data-violation="true" data-feedback="PHI! Location detail.">Room 3</span> for <span class="clickable" data-violation="true" data-feedback="PHI! Treatment area.">head & neck</span> is <span class="clickable" data-violation="true" data-feedback="Unprofessional & PHI risk.">driving me crazy.</span>`}
        ];
        let currentScenarioIndex = -1, score = 0, totalPossible = 0, totalViolations = 0;
        const scenarioContainer = document.getElementById('scenario-container'), feedbackBox = document.getElementById('feedback-box');
        const scoreBoard = document.getElementById('score-board'), nextButton = document.getElementById('next-button');
        const gameArea = document.getElementById('game-area'), resultsArea = document.getElementById('results-area');
        const endNav = document.getElementById('end-nav'), badgeSection = document.getElementById('badge-section');

        scenarios.forEach(s => { totalViolations += (s.content.match(/data-violation="true"/g) || []).length; });

        function updateScore(isCorrectViolation) {
            totalPossible++;
            if (isCorrectViolation) score++;
            scoreBoard.textContent = `Score: ${score} / ${totalPossible} | Violations Found: ${score} / ${totalViolations}`;
        }

        function handleSpanClick(event) {
            const span = event.target;
            if (!span.classList.contains('clickable') || span.classList.contains('disabled')) return;
            const isViolation = span.dataset.violation === "true";
            span.classList.add('disabled');
            span.classList.add(isViolation ? 'correct' : 'incorrect');
            updateScore(isViolation);
            feedbackBox.textContent = span.dataset.feedback;
            feedbackBox.className = isViolation ? 'feedback-correct-msg' : 'feedback-incorrect-msg';
            checkScenarioComplete();
        }

        function checkScenarioComplete() {
            const currentDiv = document.querySelector('.scenario');
            if(!currentDiv) return;
            const allClickables = currentDiv.querySelectorAll('.clickable');
            let allViolationsFound = true;
            allClickables.forEach(s => { if (s.dataset.violation === "true" && !s.classList.contains('correct')) allViolationsFound = false; });
            if (allViolationsFound) nextButton.disabled = false;
        }

        function loadNextScenario() {
            currentScenarioIndex++;
            feedbackBox.textContent = ""; feedbackBox.className = ""; nextButton.disabled = true;
            if (currentScenarioIndex < scenarios.length) {
                nextButton.textContent = "Next Scenario";
                const scenario = scenarios[currentScenarioIndex];
                scenarioContainer.innerHTML = `<div class="scenario"><div class="scenario-title">${scenario.title}</div><div class="content">${scenario.content}</div></div>`;
                document.querySelectorAll('.clickable').forEach(span => {
                    span.setAttribute('role', 'button'); span.setAttribute('tabindex', '0');
                    span.addEventListener('click', handleSpanClick);
                    span.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { handleSpanClick(e); e.preventDefault(); } });
                });
            } else { endGame(); }
        }

        function endGame() {
            gameArea.style.display = 'none'; resultsArea.style.display = 'block'; endNav.style.display = 'block';
            let incorrectClicks = totalPossible - score;
            let finalScore = (totalViolations > 0) ? Math.round((score / totalViolations) * 100) : 100;
            finalScore = Math.max(0, finalScore - (incorrectClicks * 5));
            document.getElementById('final-score').textContent = `Your Final Score: ${finalScore}%`;
            document.querySelectorAll('.rubric-table tr').forEach(row => row.classList.remove('highlight-score'));
            if (finalScore >= 90) document.getElementById('rubric-expert').classList.add('highlight-score');
            else if (finalScore >= 75) document.getElementById('rubric-proficient').classList.add('highlight-score');
            else if (finalScore >= 60) document.getElementById('rubric-developing').classList.add('highlight-score');
            else document.getElementById('rubric-novice').classList.add('highlight-score');
            if (finalScore >= 75) badgeSection.style.display = 'block'; // Show badge option if proficient or expert
            window.finalScoreValue = finalScore; // Store for badge
        }

        function generateBadge() {
            const name = document.getElementById('userNameForBadge').value;
            if (name.trim() === "") { alert("Please enter your name."); return; }
            document.getElementById('badgeName').textContent = name;
            document.getElementById('badgeScore').textContent = `Achieved with a score of ${window.finalScoreValue}%`;
            document.getElementById('printableBadge').style.display = 'flex';
            document.getElementById('printBadgeButton').style.display = 'inline-block';
        }
        nextButton.disabled = false; // Enable Start button initially
    </script>
</body>
</html>
