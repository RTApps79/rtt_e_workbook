<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beam Energy, Dmax & Depth Dose Activity</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: #fff;
            padding: 25px 35px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 900px;
            margin-bottom: 30px;
        }
        h1, h2, h3, h4 {
            color: #0056b3; /* Theme Blue */
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2em;
        }
        h2 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            color: #003d7a;
            font-size: 1.6em;
        }
        h3 {
            color: #004085;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
         h4 {
            color: #17a2b8;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }
        p, li { margin-bottom: 12px; font-size: 1.05em; }
        ul, ol { margin-bottom: 15px; padding-left: 25px; }
        strong { font-weight: 600; }
        .highlight { background-color: #e6f7ff; padding: 2px 5px; border-radius: 3px; font-weight: 600; }
        code { background-color: #e9ecef; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', Courier, monospace; color: #c7254e;}
        hr.section-divider { border: 0; border-top: 2px solid #0056b3; margin: 40px 0; }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
            font-size: 0.9em;
            color: #555;
        }
        table.data-table { width: 80%; margin: 15px auto; border-collapse: collapse; }
        table.data-table th, table.data-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        table.data-table th { background-color: #e9f5ff; color: #0056b3; font-weight: 600;}
        table.data-table tr:nth-child(even) { background-color: #f9f9f9; }


        /* --- Flip Page Lesson Styles --- */
        .flip-lesson-container {
            border: 1px solid #b3d7ff; padding: 20px; border-radius: 8px;
            background-color: #f0f8ff; margin-bottom: 30px;
        }
        .lesson-page {
            display: none; padding: 15px; border: 1px solid #ddeeff;
            background-color: #fff; border-radius: 5px; min-height: 400px;
        }
        .lesson-page.active { display: block; }
        .lesson-navigation { text-align: center; margin-top: 20px; }
        .lesson-navigation button, .lesson-page .check-page-answers {
            background-color: #007bff; color: white; padding: 10px 20px;
            border: none; border-radius: 5px; cursor: pointer; font-size: 1em;
            margin: 5px 10px; transition: background-color 0.2s;
        }
        .lesson-navigation button:hover, .lesson-page .check-page-answers:hover { background-color: #0056b3; }
        .lesson-navigation button:disabled { background-color: #ccc; cursor: not-allowed; }
        .page-indicator { font-style: italic; color: #555; margin: 10px 0; }
        .key-principle { background-color: #e7f3ff; padding: 10px; margin-bottom:10px; border-left: 3px solid #007bff; border-radius: 3px;}
        .formula { font-family: 'Courier New', Courier, monospace; background-color:#f0f0f0; padding: 5px 8px; border-radius: 4px; display: inline-block; font-size: 1.1em;}


        /* Interactive Questions within Lesson */
        .interactive-question-block {
            background: #f9f9f9; padding: 15px; margin: 20px 0;
            border: 1px solid #e0e0e0; border-radius: 8px;
        }
        .interactive-question-block .question-text { font-weight: bold; margin-bottom: 8px; font-size: 1em; color: #555; }
        .interactive-question-block label { display: block; margin-left: 0; padding: 8px 12px; border-radius: 5px; cursor: pointer; border: 1px solid transparent; margin-bottom: 5px; }
        .interactive-question-block input[type="radio"] { margin-right: 10px; vertical-align: middle; }
        .interactive-question-block label:hover { background-color: #f0f8ff; }
        .feedback-correct { background-color: #e8f8f0 !important; border-left: 4px solid #2ecc71 !important; }
        .feedback-incorrect { background-color: #fdedec !important; border-left: 4px solid #e74c3c !important; }
        .feedback-correct label.correct-option,
        .feedback-incorrect label.correct-option { font-weight: bold; color: #1E8449; }
        .feedback-incorrect label.selected-incorrect { color: #A93226; }
        .explanation { font-size: 0.9em; color: #444; margin-top: 5px; padding-left: 20px;}

        /* --- Worksheet Activity Styles --- */
        #activity-section .section-header {
            text-align: center; color: #0056b3; margin-bottom: 1em;
            border-bottom: 1px solid #eee; padding-bottom: 0.5em; font-size: 1.5em;
        }
        #worksheet-questions-section { margin-top: 30px; text-align: left; }
        #worksheet-questions-section .section-ws { border-left-color: #28a745; background-color: #e6fffa; padding: 15px; border: 1px solid #c3e6cb; border-radius: 5px; margin-bottom: 20px;}
        #worksheet-questions-section .question-group { margin-bottom: 1.5rem; }
        #worksheet-questions-section .question-group h4 { color: #004085; margin-bottom: 0.75rem; font-size: 1.15em;}
        #worksheet-questions-section label.ws-label { display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600; font-size: 1.05em; }
        textarea.worksheet-answer, input.worksheet-answer[type="text"], input.worksheet-answer[type="number"] {
            width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #d1d5db;
            border-radius: 4px; box-sizing: border-box; font-size: 1em;
        }
        textarea.worksheet-answer { min-height: 80px; resize: vertical; }
        .button-container { text-align: center; margin-top: 30px; }
        .button-container button { background-color: #28a745; border-color: #28a745; padding: 12px 25px; }
        .button-container button:hover { background-color: #218838; }

        /* Print Styles */
        @media print {
            body { background-color: #fff; margin: 10px; padding: 0; font-size: 10pt; }
            .container, .flip-lesson-container { box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 5px; margin-bottom: 15px;}
            .lesson-navigation, .button-container, .check-page-answers { display: none; }
            .lesson-page, .section-ws, #worksheet-questions-section .question-group { page-break-inside: avoid; border: 1px solid #eee; }
            .interactive-question-block {background: #fff !important; border: 1px solid #ccc !important; }
            #activity-section { margin-top: 30px; }
            h1, h2, h3, h4 { color: #000; border-color: #000; margin-bottom: 10px; padding-bottom: 3px;}
            textarea.worksheet-answer, input.worksheet-answer { background-color: #f0f0f0 !important; border: 1px solid #999 !important; }
            .explanation { display: none; }
            .footer { text-align: center !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Beam Energy, D<sub>max</sub> & Depth Dose Characteristics</h1>

        <div class="flip-lesson-container">
            <h2>Interactive Lesson: Understanding Dose Deposition</h2>

            <div id="lesson-page-1" class="lesson-page active">
                <h3>Page 1: Introduction to D<sub>max</sub> (Depth of Maximum Dose)</h3>
                <p>In radiation therapy, <span class="highlight">D<sub>max</sub></span> (also written as d<sub>max</sub>) refers to the specific depth beneath the patient's skin (or phantom surface) where the absorbed dose from a radiation beam reaches its highest value. It's a critical concept for treatment planning and understanding how different radiation beams interact with tissue.</p>
                <p><strong>Why is D<sub>max</sub> important?</strong></p>
                <ul>
                    <li><strong>Treatment Planning:</strong> Knowing D<sub>max</sub> helps in positioning the target volume relative to the beam entrance to ensure adequate tumor coverage while potentially sparing superficial tissues.</li>
                    <li><strong>Skin Sparing:</strong> For megavoltage photon beams, the dose at the skin surface is lower than at D<sub>max</sub>. This "skin-sparing" effect is often desirable to reduce acute skin reactions.</li>
                    <li><strong>Beam Characterization:</strong> D<sub>max</sub> is one of the key parameters used to characterize a radiation beam's energy and penetration.</li>
                    <li><strong>Normalization Point:</strong> Dose calculations are often normalized to the dose at D<sub>max</sub> (or another reference depth related to it).</li>
                </ul>
                <p>This lesson will explore D<sub>max</sub> for both photon and electron beams and the factors that influence it.</p>
            </div>

            <div id="lesson-page-2" class="lesson-page">
                <h3>Page 2: D<sub>max</sub> for Photon Beams</h3>
                <p>For megavoltage photon beams (like those from a linear accelerator), the depth of D<sub>max</sub> is primarily determined by the <span class="highlight">beam's energy</span>.</p>
                <div class="key-principle">
                    <p>As the energy of the photon beam <span class="highlight">increases</span>, the depth of D<sub>max</sub> also <span class="highlight">increases</span> (occurs deeper in the tissue).</p>
                    <p>This is because higher-energy photons produce secondary electrons (through Compton and Photoelectric interactions) that have more energy and are predominantly scattered in the forward direction. These electrons travel further into the tissue before depositing their maximum energy, leading to a dose build-up region.</p>
                </div>
                <div class="key-principle">
                    <h4>Skin-Sparing Effect:</h4>
                    <p>The dose at the very surface of the skin is lower than the dose at D<sub>max</sub>. This build-up of dose from the surface to D<sub>max</sub> is known as the "skin-sparing" effect, which is clinically beneficial for reducing acute skin reactions.</p>
                </div>
                <p>While the overall shape of the Percentage Depth Dose (PDD) curve is influenced by field size (due to scatter radiation), the *specific depth* of D<sub>max</sub> for photons is less sensitive to changes in field size compared to electron beams.</p>
            </div>

            <div id="lesson-page-3" class="lesson-page">
                <h3>Page 3: Typical Photon D<sub>max</sub> Depths</h3>
                <p>Here are typical approximate D<sub>max</sub> depths in water for common megavoltage photon beam energies used in radiation therapy:</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Beam Energy (MV)</th>
                            <th>Approximate D<sub>max</sub> Depth (cm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Cobalt-60 (~1.25 MV average)</td><td>0.5 cm</td></tr>
                        <tr><td>4 MV</td><td>1.0 cm</td></tr>
                        <tr><td>6 MV</td><td>1.5 cm</td></tr>
                        <tr><td>10 MV</td><td>2.5 cm</td></tr>
                        <tr><td>15 MV</td><td>3.0 cm</td></tr>
                        <tr><td>18 MV</td><td>3.5 cm</td></tr>
                        <tr><td>20-25 MV</td><td>~4.0-5.0 cm</td></tr>
                    </tbody>
                </table>
                <p><em>Note: These are general values and can vary slightly between different linear accelerator models, machine calibration, and measurement conditions.</em></p>
                <h4>Quick Check!</h4>
                <div class="interactive-question-block" id="lq_page3_1_block">
                    <p class="question-text">What is the approximate D<sub>max</sub> depth for a 10 MV photon beam?</p>
                    <label><input type="radio" name="lq_page3_1" value="A"> 1.5 cm</label>
                    <label><input type="radio" name="lq_page3_1" value="B"> 2.5 cm</label>
                    <label><input type="radio" name="lq_page3_1" value="C"> 3.5 cm</label>
                    <div class="explanation" style="display:none;">B. A 10 MV photon beam typically has a D<sub>max</sub> around 2.5 cm.</div>
                </div>
                <button class="check-page-answers" onclick="checkPageAnswers(3)">Check Answer</button>
            </div>

            <div id="lesson-page-4" class="lesson-page">
                <h3>Page 4: D<sub>max</sub> for Electron Beams</h3>
                <p>Electron beams behave quite differently from photon beams in terms of dose deposition.</p>
                <div class="key-principle">
                    <p><strong>Factors Influencing Electron D<sub>max</sub>:</strong></p>
                    <ul>
                        <li><strong>Energy:</strong> Higher electron energy leads to a deeper D<sub>max</sub> and greater penetration.</li>
                        <li><strong>Field Size:</strong> Electron D<sub>max</sub> is <span class="highlight">significantly dependent on field size</span>, especially for smaller fields (determined by the applicator/cone and any custom cutouts). As field size decreases below a certain point (related to the lateral range of electrons), the D<sub>max</sub> depth shifts shallower due to a loss of lateral scatter equilibrium.</li>
                        <li><strong>Scattering:</strong> Electrons scatter much more readily in tissue than photons, leading to a less sharply defined beam edge and a more complex dose distribution.</li>
                    </ul>
                </div>
                <div class="key-principle">
                    <h4>Key Characteristics of Electron Beams:</h4>
                    <ul>
                        <li><span class="highlight">Higher Surface Dose:</span> Electrons typically deliver a higher dose at or very near the surface (e.g., 80-95% of maximum dose) compared to the skin-sparing effect of megavoltage photons.</li>
                        <li><strong>Rapid Dose Fall-off:</strong> Beyond D<sub>max</sub>, the dose from an electron beam decreases sharply, leading to a relatively well-defined <span class="highlight">practical range (R<sub>p</sub>)</span> beyond which the dose is negligible. This makes them ideal for treating superficial targets while sparing deeper normal tissues.</li>
                    </ul>
                </div>
            </div>

            <div id="lesson-page-5" class="lesson-page">
                <h3>Page 5: Electron Beam Depth Rules of Thumb</h3>
                <p>Due to their characteristic dose fall-off, several "rules of thumb" are used to quickly estimate useful depths for electron beams based on their energy (E) in MeV:</p>
                <div class="key-principle">
                    <ul>
                        <li><strong>Practical Range (R<sub>p</sub>) in cm ≈ E / 2</strong>
                            <br>This is the depth at which the electrons essentially stop, and the dose drops to a very low level (often defined by extrapolating the steepest part of the fall-off to zero).
                        </li>
                        <li><strong>Depth of 80% Isodose Line in cm ≈ E / 3</strong>
                            <br>This depth is often considered the approximate <span class="highlight">therapeutic range</span> for many clinical situations.
                        </li>
                        <li><strong>Depth of 90% Isodose Line in cm ≈ E / 4</strong>
                            <br>This provides a more conservative estimate of the depth adequately covered by the beam.
                        </li>
                    </ul>
                    <p>The D<sub>max</sub> depth itself for electrons is typically shallow, often 0.5 cm to a few centimeters, increasing with energy. For example, a 9 MeV electron beam might have a D<sub>max</sub> around 2.0 - 2.2 cm, its 80% depth around 3 cm, and its practical range around 4.5 cm (these vary with field size).</p>
                </div>
                <h4>Quick Check!</h4>
                <div class="interactive-question-block" id="lq_page5_1_block">
                    <p class="question-text">For a 12 MeV electron beam, what is the approximate depth of the 80% isodose line?</p>
                    <label><input type="radio" name="lq_page5_1" value="A"> 3 cm</label>
                    <label><input type="radio" name="lq_page5_1" value="B"> 4 cm</label>
                    <label><input type="radio" name="lq_page5_1" value="C"> 6 cm</label>
                    <div class="explanation" style="display:none;">B. Using E/3, the 80% depth is approximately 12 MeV / 3 = 4 cm.</div>
                </div>
                <button class="check-page-answers" onclick="checkPageAnswers(5)">Check Answer</button>
            </div>

            <div id="lesson-page-6" class="lesson-page">
                <h3>Page 6: Summary: Photon vs. Electron D<sub>max</sub> & Dose Deposition</h3>
                <p>It's crucial to understand the fundamental differences in how photons and electrons deposit dose:</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Characteristic</th>
                            <th>Megavoltage Photons</th>
                            <th>Electron Beams</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Primary D<sub>max</sub> Dependence</strong></td>
                            <td>Beam Energy</td>
                            <td>Beam Energy & Field Size</td>
                        </tr>
                        <tr>
                            <td><strong>Skin Sparing</strong></td>
                            <td>Significant (dose builds up)</td>
                            <td>Minimal (high surface dose)</td>
                        </tr>
                        <tr>
                            <td><strong>Dose Fall-off Beyond D<sub>max</sub></strong></td>
                            <td>Gradual</td>
                            <td>Rapid, with a defined practical range</td>
                        </tr>
                        <tr>
                            <td><strong>Penetration</strong></td>
                            <td>Highly penetrating (exit dose)</td>
                            <td>Superficial penetration (finite range)</td>
                        </tr>
                        <tr>
                            <td><strong>Lateral Scatter</strong></td>
                            <td>Less significant for beam edge definition</td>
                            <td>More significant, affects penumbra and small field dosimetry</td>
                        </tr>
                        <tr>
                            <td><strong>Typical Clinical Use</strong></td>
                            <td>Deep-seated tumors</td>
                            <td>Superficial tumors (e.g., skin, lymph nodes, boost sites)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="lesson-page-7" class="lesson-page">
                <h3>Page 7: Dose Changes: Depth vs. Distance from Source</h3>
                <p>It's important to distinguish between dose changes due to penetration <span class="highlight">depth</span> within a patient/phantom and dose changes due to <span class="highlight">distance</span> from the radiation source (Source-to-Surface Distance, SSD).</p>
                <div class="key-principle">
                    <h4>Dose Changes Due to Depth (Fixed SSD):</h4>
                    <p>When radiation enters a medium, the dose changes as it penetrates deeper. This is described by:</p>
                    <ul>
                        <li><strong>Percentage Depth Dose (PDD):</strong> The ratio (as a percentage) of the absorbed dose at a specific depth to the absorbed dose at D<sub>max</sub>, along the central axis of the beam, for a fixed SSD.
                            <br><code>Dose at depth = Dose at D<sub>max</sub> × (PDD at depth / 100)</code></li>
                        <li><strong>Tissue-Maximum Ratio (TMR) or Tissue-Phantom Ratio (TPR):</strong> Used for SAD (Source-to-Axis Distance) setups, these ratios relate dose at depth to dose in a phantom at D<sub>max</sub> (TMR) or a reference depth (TPR) *at the same point in space*.</li>
                    </ul>
                    <p>These factors account for attenuation and scatter within the medium.</p>
                </div>
                 <h4>Quick Check!</h4>
                <div class="interactive-question-block" id="lq_page7_1_block">
                    <p class="question-text">If the dose at D<sub>max</sub> for a 6MV beam (SSD setup) is 200 cGy and the PDD at 5cm depth is 85%, the dose at 5cm depth is:</p>
                    <label><input type="radio" name="lq_page7_1" value="A"> 85 cGy</label>
                    <label><input type="radio" name="lq_page7_1" value="B"> 170 cGy</label>
                    <label><input type="radio" name="lq_page7_1" value="C"> 200 cGy</label>
                    <div class="explanation" style="display:none;">B. Dose at 5cm = 200 cGy * (85/100) = 170 cGy.</div>
                </div>
                <button class="check-page-answers" onclick="checkPageAnswers(7)">Check Answer</button>
            </div>

            <div id="lesson-page-8" class="lesson-page">
                <h3>Page 8: Dose Changes Due to Distance from Source (Extended SSD)</h3>
                <div class="key-principle">
                    <h4>Dose Changes Due to Distance from Source (Variable SSD):</h4>
                    <p>When the SSD changes from a standard calibration distance (e.g., 100 cm) to a new, non-standard distance (often called extended SSD), the dose rate at D<sub>max</sub> (and other depths) changes due to:</p>
                    <ul>
                        <li><strong>Inverse Square Law (ISL):</strong> The primary effect. As distance increases, intensity decreases by the square of the distance.</li>
                        <li><strong>Changes in Scatter:</strong> Scatter contribution to D<sub>max</sub> can change slightly with SSD.</li>
                    </ul>
                    <p>To correct PDD values or dose rates for non-standard SSDs, the <span class="highlight">Mayneord F Factor</span> is often used for photon beams:</p>
                    <p class="formula">F = [(SSD₂ + D<sub>max</sub>) / (SSD₁ + D<sub>max</sub>)]² × [(SSD₁ + depth) / (SSD₂ + depth)]²</p>
                    <p>The first term accounts for ISL at D<sub>max</sub>, and the second for ISL at depth. Simpler ISL corrections are often applied to the output factor.</p>
                    <p><span class="highlight">Crucially: PDD, TMR, and TPR inherently account for attenuation and scatter *at a given SSD or SAD*. The Mayneord F Factor (or ISL) is used when the *SSD itself changes* from the reference condition.</span></p>
                </div>
            </div>

            <div id="lesson-page-9" class="lesson-page">
                <h3>Page 9: Clarifying Depth vs. Distance Corrections</h3>
                <p>Let's summarize the distinction:</p>
                <ul>
                    <li>To find the dose at a certain <span class="highlight">depth</span> for a *given, fixed SSD setup*, you use PDD (or TMR/TPR for SAD setups).
                        <ul><li>Example: Dose at D<sub>max</sub> is 100 cGy, PDD at 10 cm is 67%. Dose at 10 cm = 100 * 0.67 = 67 cGy.</li></ul>
                    </li>
                    <li>If you change the <span class="highlight">SSD</span> from the standard calibration distance (e.g., from 100 cm to 110 cm), the dose rate at *all points* (including D<sub>max</sub> and other depths) will change primarily due to the Inverse Square Law. You would use an ISL correction factor (or Mayneord F factor for PDD adjustments) to find the new dose rate or adjust monitor units.
                        <ul><li>Example: If output is 1 cGy/MU at 100 cm SSD, at 110 cm SSD, the output will be 1 * (100/110)² cGy/MU.</li></ul>
                    </li>
                </ul>
                <p>It's vital not to confuse these two distinct scenarios and apply the correct factors.</p>
            </div>


            <div id="lesson-page-10" class="lesson-page">
                <h3>Page 10: Transition to Activity</h3>
                <p>You've now reviewed the ALARA principle, the Inverse Square Law, and the concepts of D<sub>max</sub> and depth dose characteristics for photon and electron beams, including the important distinction between depth-related dose changes and distance-related dose changes.</p>
                <p>The following activity will allow you to:</p>
                <ol>
                    <li>Interactively explore the Inverse Square Law using a simulator.</li>
                    <li>Apply your understanding of ALARA, ISL, and D<sub>max</sub> concepts by answering worksheet questions.</li>
                </ol>
                <p>Click "Start Activity" below to begin.</p>
            </div>

            <div class="lesson-navigation">
                <button id="prevLessonPage" onclick="changeLessonPage(-1)" disabled>Previous Page</button>
                <span class="page-indicator" id="lessonPageIndicator">Page 1 of 10</span>
                <button id="nextLessonPage" onclick="changeLessonPage(1)">Next Page</button>
                <button id="startActivityButton" onclick="startCaseActivity()" style="display:none; background-color: #28a745;">Start Activity</button>
            </div>
        </div>

        <div id="activity-section" style="display:none;">
            <hr class="section-divider">
            <h2 id="interactive-simulator-header" class="section-header">Part 1: Inverse Square Law Simulator</h2>
            <div class="isl-simulator-container">
                 <div class="text-sm text-center text-gray-600 mb-4 p-3 bg-yellow-100 border border-yellow-300 rounded-md">
                    Reference: Source emits <strong id="ref-dose-sim">100.0</strong> mSv/hr at <strong id="ref-dist-sim">1.0</strong> meter.
                </div>
                <div id="visualization-area">
                    <div id="source" title="Radiation Source" style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                        <img src="https://static.grainger.com/rp/s/is/image/Grainger/484H60_AL01?$adapimg$&hei=536&wid=536" alt="Radiation Source Icon" style="max-width: 100%; max-height: 100%;">
                    </div>
                    <div id="detector" title="Detector">Meter</div>
                    <div id="distance-line"></div>
                    <div id="distance-label"><span id="current-distance-vis">1.0</span> m</div>
                </div>
                <div class="mt-6 mb-6">
                    <label for="distance-slider" class="block text-lg font-medium text-gray-700 mb-2">Adjust Distance (meters):</label>
                    <input type="range" id="distance-slider" name="distance" min="0.5" max="10" step="0.1" value="1.0"
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    <div class="text-center text-xl font-semibold text-blue-600 mt-2">
                        Current Distance: <span id="current-distance-sim">1.0</span> m
                    </div>
                </div>
                <div class="text-center p-4 bg-blue-100 border border-blue-300 rounded-lg mb-6">
                    <p class="text-lg font-medium text-gray-700">Simulated Dose Rate:</p>
                    <p class="text-3xl font-bold text-red-600">
                        <span id="dose-rate-sim">100.0</span> mSv/hr
                    </p>
                </div>
                <div class="mb-4">
                    <p class="text-lg font-medium text-gray-700 text-center mb-2">Relative Dose Rate</p>
                    <div id="graph-area">
                        <div id="dose-bar" style="height: 100%;"> <span id="dose-bar-label">100%</span></div>
                    </div>
                </div>
                <div class="text-sm text-center text-gray-500 mt-4 p-2 bg-gray-50 rounded">
                    Formula: I₂ = I₁ * (d₁ / d₂)²
                </div>
            </div>

            <div id="worksheet-questions-section">
                <hr class="section-divider">
                <h2 class="section-header">Part 2: ALARA & D<sub>max</sub> Worksheet</h2>
                 <form id="alara-worksheet-form">
                    <div class="section-ws">
                        <h3>Part 2A: Inverse Square Law and the Simulator</h3>
                        <p class="instructions-ws">Use the simulator above. Reference: Source emits 100.0 mSv/hr at 1.0 meter.</p>
                        <div class="question-group">
                            <h4>1. Initial Setup & Observation</h4>
                            <label for="q1a" class="ws-label">a) What is the simulated dose rate at a distance of 1.0 meter from the source?</label>
                            <input type="text" id="q1a" name="q1a" class="worksheet-answer">
                            <label for="q1b" class="ws-label">b) How does the "dose bar" height correspond to this dose rate?</label>
                            <textarea id="q1b" name="q1b" class="worksheet-answer" placeholder="Describe dose bar height..."></textarea>
                        </div>
                        <div class="question-group">
                            <h4>2. Increasing Distance</h4>
                            <p>Move the slider to increase the distance to 2.0 meters.</p>
                            <label for="q2a" class="ws-label">a) What is the new simulated dose rate?</label>
                            <input type="text" id="q2a" name="q2a" class="worksheet-answer" placeholder="Simulated dose rate at 2.0m...">
                            <label for="q2b" class="ws-label">b) Calculate the expected dose rate at 2.0 meters using the inverse square law formula: I₂ = I₁ × (d₁/d₂)². Show your work.</label>
                            <textarea id="q2b" name="q2b" class="worksheet-answer" placeholder="Show ISL calculation for 2.0m..."></textarea>
                            <label for="q2c" class="ws-label">c) How does the simulated dose rate compare to your calculated value?</label>
                            <textarea id="q2c" name="q2c" class="worksheet-answer" placeholder="Comparison of simulated vs. calculated..."></textarea>
                            <label for="q2d" class="ws-label">d) Describe how the visual representation (detector position, distance line, and dose bar) changes as you double the distance.</label>
                            <textarea id="q2d" name="q2d" class="worksheet-answer" placeholder="Describe visual changes..."></textarea>
                        </div>
                         <div class="question-group">
                            <h4>3. Further Distance</h4>
                             <p>Set the distance to 4.0 meters using the slider.</p>
                            <label for="q3a" class="ws-label">a) What is the simulated dose rate?</label>
                            <input type="text" id="q3a" name="q3a" class="worksheet-answer" placeholder="Simulated dose rate at 4.0m...">
                            <label for="q3b" class="ws-label">b) Calculate the expected dose rate at 4.0 meters using the inverse square law formula. Show your work.</label>
                            <textarea id="q3b" name="q3b" class="worksheet-answer" placeholder="Show ISL calculation for 4.0m..."></textarea>
                            <label for="q3c" class="ws-label">c) What is the relationship between doubling the distance (e.g., from 2m to 4m) and the change in dose rate?</label>
                            <textarea id="q3c" name="q3c" class="worksheet-answer" placeholder="Relationship when doubling distance..."></textarea>
                        </div>
                        <div class="question-group">
                            <h4>4. Decreasing Distance</h4>
                            <p>Return the slider to 1.0 meter. Now, decrease the distance to 0.5 meters.</p>
                            <label for="q4a" class="ws-label">a) What is the simulated dose rate?</label>
                            <input type="text" id="q4a" name="q4a" class="worksheet-answer" placeholder="Simulated dose rate at 0.5m...">
                            <label for="q4b" class="ws-label">b) Calculate the expected dose rate at 0.5 meters using the inverse square law formula. Show your work.</label>
                            <textarea id="q4b" name="q4b" class="worksheet-answer" placeholder="Show ISL calculation for 0.5m..."></textarea>
                            <label for="q4c" class="ws-label">c) What happens to the dose rate when you halve the distance from the source?</label>
                            <textarea id="q4c" name="q4c" class="worksheet-answer" placeholder="Effect of halving distance..."></textarea>
                        </div>
                         <div class="question-group">
                             <h4>5. Applying the Simulator</h4>
                            <label for="q5a" class="ws-label">a) A radiation therapist is initially positioned 1.5 meters from a radiation source. Using the simulator, determine the approximate dose rate at this distance.</label>
                            <input type="text" id="q5a" name="q5a" class="worksheet-answer" placeholder="Dose rate at 1.5m...">
                             <label for="q5b" class="ws-label">b) The therapist needs to move to a location where the dose rate is no more than 25 mSv/hr. Use the simulator to find the minimum distance the therapist must be from the source.</label>
                            <input type="text" id="q5b" name="q5b" class="worksheet-answer" placeholder="Min. distance for ≤ 25 mSv/hr...">
                        </div>
                    </div>
                    <div class="section-ws">
                        <h3>Part 2B: Conceptual Understanding of ALARA & D<sub>max</sub></h3>
                        <div class="question-group">
                            <label for="q6" class="ws-label">6. Define ALARA: Explain the ALARA principle in your own words. What do the acronym letters stand for, and what is the underlying goal?</label>
                            <textarea id="q6" name="q6" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="q7" class="ws-label">7. Time Limitation: How does the ALARA principle relate to the time spent in the vicinity of a radiation source? Provide a specific example of how limiting time can reduce radiation exposure in a radiation therapy setting.</label>
                            <textarea id="q7" name="q7" class="worksheet-answer"></textarea>
                        </div>
                         <div class="question-group">
                            <label for="q8" class="ws-label">8. Distance Maximization & ISL: Explain how the inverse square law (explored in Part 2A) is directly related to the "Distance" aspect of ALARA. Describe a situation in radiation therapy where increasing distance is a practical way to reduce exposure.</label>
                            <textarea id="q8" name="q8" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="q9" class="ws-label">9. Shielding Utilization: Explain how shielding materials help to reduce radiation exposure. Give an example of when shielding might be used in a radiation therapy department for photons or electrons.</label>
                            <textarea id="q9" name="q9" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                             <label for="q10" class="ws-label">10. D<sub>max</sub> Recall: What are the approximate D<sub>max</sub> depths in cm for the following photon beam energies: 4MV, 6MV, 10MV, 18MV? (Recall from lesson)</label>
                             <textarea id="q10" name="q10" class="worksheet-answer" placeholder="4MV: ? cm, 6MV: ? cm, 10MV: ? cm, 18MV: ? cm"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="q11" class="ws-label">11. Factors Influencing D<sub>max</sub>: What is the primary factor influencing D<sub>max</sub> for photon beams? What are the primary factors for electron beams?</label>
                            <textarea id="q11" name="q11" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="q12" class="ws-label">12. Electron Beam Rules: For a 12 MeV electron beam, estimate the approximate depths for: a) Practical Range (Rp using E/2), b) 80% isodose line (using E/3), and c) 90% isodose line (using E/4).</label>
                            <textarea id="q12" name="q12" class="worksheet-answer" placeholder="a) Rp = ? cm, b) 80% depth = ? cm, c) 90% depth = ? cm"></textarea>
                        </div>
                         <div class="question-group">
                            <label for="q13" class="ws-label">13. Tumor Depth & Energy: Describe how a change in tumor depth would influence the choice of beam energy (photon or electron). How does changing beam energy affect the absorbed dose at D<sub>max</sub> versus the dose at a deeper depth?</label>
                            <textarea id="q13" name="q13" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="q14" class="ws-label">14. Depth vs. Distance Correction: A patient is treated at a standard SSD of 100 cm. If the SSD is changed to 120 cm for a specific treatment, which factor is primarily used to correct for the change in dose rate at D<sub>max</sub>? If you want to find the dose at 10cm depth for the *original* 100cm SSD setup, which factor would you use?</label>
                            <textarea id="q14" name="q14" class="worksheet-answer" placeholder="Factor for SSD change: ? Factor for depth dose: ?"></textarea>
                        </div>
                    </div>
                    <div class="reflection section-ws">
                        <h3>Reflection</h3>
                        <div class="question-group">
                            <label for="reflection1" class="ws-label">How did using the simulator help you understand the relationship between distance and radiation dose rate?</label>
                            <textarea id="reflection1" name="reflection1" class="worksheet-answer"></textarea>
                        </div>
                        <div class="question-group">
                            <label for="reflection2" class="ws-label">What is the most important takeaway for you regarding the application of ALARA and D<sub>max</sub> principles in radiation therapy?</label>
                            <textarea id="reflection2" name="reflection2" class="worksheet-answer"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <div class="button-container">
                <button onclick="window.print()">Print Lesson & Responses</button>
            </div>
        </div>
        <div class="footer">
            <p>&copy; RTApps 2025</p>
        </div>
    </div>

    <script>
        // --- Lesson Page Navigation ---
        let currentLessonPage = 1;
        const totalLessonPages = 10;
        const lessonPages = document.querySelectorAll('.lesson-page');
        const prevLessonButton = document.getElementById('prevLessonPage');
        const nextLessonButton = document.getElementById('nextLessonPage');
        const lessonPageIndicator = document.getElementById('lessonPageIndicator');
        const startActivityButton = document.getElementById('startActivityButton');
        const activitySection = document.getElementById('activity-section');

        const lessonCorrectAnswers = {
            lq_page2_1: "B", lq_page4_1: "B", lq_page5_1: "False", lq_page7_1: "B"
        };

        function displayLessonPage() {
            lessonPages.forEach((page, index) => page.classList.toggle('active', index === currentLessonPage - 1));
            prevLessonButton.disabled = currentLessonPage === 1;
            nextLessonButton.style.display = currentLessonPage === totalLessonPages ? 'none' : 'inline-block';
            startActivityButton.style.display = currentLessonPage === totalLessonPages ? 'inline-block' : 'none';
            lessonPageIndicator.textContent = `Page ${currentLessonPage} of ${totalLessonPages}`;
        }
        function changeLessonPage(direction) {
            currentLessonPage += direction;
            if (currentLessonPage < 1) currentLessonPage = 1;
            if (currentLessonPage > totalLessonPages) currentLessonPage = totalLessonPages;
            displayLessonPage();
        }
        function startCaseActivity() {
            document.querySelector('.flip-lesson-container').style.display = 'none';
            activitySection.style.display = 'block';
            activitySection.scrollIntoView({ behavior: 'smooth' });
            initializeISLSimulator();
        }
         function checkPageAnswers(pageNumber) {
            const questionsOnPage = document.querySelectorAll(`#lesson-page-${pageNumber} .interactive-question-block`);
            questionsOnPage.forEach(block => {
                const questionName = block.querySelector('input[type="radio"]').name;
                if (!lessonCorrectAnswers.hasOwnProperty(questionName)) return;
                const correctAnswerValue = lessonCorrectAnswers[questionName];
                const selectedRadio = block.querySelector(`input[name="${questionName}"]:checked`);
                const explanationDiv = block.querySelector('.explanation');
                block.classList.remove('feedback-correct', 'feedback-incorrect');
                block.querySelectorAll('label').forEach(label => label.classList.remove('correct-option', 'selected-incorrect'));
                if(explanationDiv) explanationDiv.style.display = 'none';
                if (selectedRadio) {
                    const userAnswer = selectedRadio.value;
                    const userSelectedLabel = selectedRadio.parentElement;
                    if (userAnswer === correctAnswerValue) {
                        block.classList.add('feedback-correct');
                        if(userSelectedLabel) userSelectedLabel.classList.add('correct-option');
                    } else {
                        block.classList.add('feedback-incorrect');
                        if(userSelectedLabel) userSelectedLabel.classList.add('selected-incorrect');
                        const correctRadio = block.querySelector(`input[name="${questionName}"][value="${correctAnswerValue}"]`);
                        if (correctRadio && correctRadio.parentElement) correctRadio.parentElement.classList.add('correct-option');
                    }
                } else {
                    block.classList.add('feedback-incorrect');
                    const correctRadio = block.querySelector(`input[name="${questionName}"][value="${correctAnswerValue}"]`);
                    if (correctRadio && correctRadio.parentElement) correctRadio.parentElement.classList.add('correct-option');
                }
                if(explanationDiv) explanationDiv.style.display = 'block';
            });
        }
        displayLessonPage();

        // --- Inverse Square Law Simulator Logic ---
        let distanceSliderISL, currentDistanceDisplayISL, currentDistanceVisISL, doseRateDisplayISL;
        let detectorElementISL, sourceElementISL, visualizationAreaISL, distanceLineISL, distanceLabelISL;
        let doseBarISL, doseBarLabelISL, refDoseDisplayISL, refDistDisplayISL;

        const I1_SIM = 100.0; 
        const d1_SIM = 1.0;   

        function calculateISLDoseRate(d2_val) {
            if (d2_val <= 0) return Infinity;
            return I1_SIM * Math.pow(d1_SIM / d2_val, 2);
        }

        function updateISLSimulatorVisuals() {
            if (!distanceSliderISL || !visualizationAreaISL || !sourceElementISL || !detectorElementISL || !distanceLineISL || !doseBarISL) {
                 console.warn("ISL Simulator visuals not fully initialized.");
                 return;
            }

            const d2 = parseFloat(distanceSliderISL.value);
            const I2 = calculateISLDoseRate(d2);

            currentDistanceDisplayISL.textContent = d2.toFixed(1);
            if(currentDistanceVisISL) currentDistanceVisISL.textContent = d2.toFixed(1);
            doseRateDisplayISL.textContent = I2.toFixed(1);

            const areaWidth = visualizationAreaISL.offsetWidth;
            const sourceIconWidth = sourceElementISL.offsetWidth || 30; 
            const sourceLeftVisual = parseFloat(getComputedStyle(sourceElementISL).left) || 30;
            const sourceCenterVisual = sourceLeftVisual + sourceIconWidth / 2;

            const detectorWidth = detectorElementISL.offsetWidth || 25;
            const minVisDist = parseFloat(distanceSliderISL.min);
            const maxVisDist = parseFloat(distanceSliderISL.max);
            
            const usableVisWidth = areaWidth - sourceCenterVisual - (detectorWidth / 2) - 20; 
            const scaleFactor = usableVisWidth > 0 ? usableVisWidth / (maxVisDist - minVisDist) : 50; 

            let detectorNewLeft = sourceCenterVisual + (d2 - minVisDist) * scaleFactor - (detectorWidth / 2);
            detectorElementISL.style.left = `${Math.max(sourceCenterVisual + 5, Math.min(detectorNewLeft, areaWidth - detectorWidth - 5))}px`;

            const lineStart = sourceLeftVisual + sourceIconWidth;
            const lineEnd = parseFloat(detectorElementISL.style.left);
            distanceLineISL.style.left = `${lineStart}px`;
            distanceLineISL.style.width = `${Math.max(0, lineEnd - lineStart)}px`;
            if(distanceLabelISL) distanceLabelISL.style.left = `${lineStart + (lineEnd - lineStart) / 2}px`;

            const maxPossibleDoseAtMinDist = calculateISLDoseRate(minVisDist);
            let relativeDosePercent = (maxPossibleDoseAtMinDist > 0) ? (I2 / maxPossibleDoseAtMinDist) * 100 : 0;
            relativeDosePercent = Math.min(100, Math.max(0, relativeDosePercent)); 
            doseBarISL.style.height = `${relativeDosePercent}%`;
            const percentOfReferenceI1 = (I1_SIM > 0) ? (I2 / I1_SIM) * 100 : 0;
            doseBarLabelISL.textContent = `${percentOfReferenceI1.toFixed(0)}%`;
        }

        function initializeISLSimulator() {
            distanceSliderISL = document.getElementById('distance-slider');
            currentDistanceDisplayISL = document.getElementById('current-distance-sim');
            currentDistanceVisISL = document.getElementById('current-distance-vis');
            doseRateDisplayISL = document.getElementById('dose-rate-sim');
            detectorElementISL = document.getElementById('detector');
            sourceElementISL = document.getElementById('source');
            visualizationAreaISL = document.getElementById('visualization-area');
            distanceLineISL = document.getElementById('distance-line');
            distanceLabelISL = document.getElementById('distance-label');
            doseBarISL = document.getElementById('dose-bar');
            doseBarLabelISL = document.getElementById('dose-bar-label');
            refDoseDisplayISL = document.getElementById('ref-dose-sim');
            refDistDisplayISL = document.getElementById('ref-dist-sim');

            if (!distanceSliderISL || !visualizationAreaISL || !sourceElementISL || !detectorElementISL || !distanceLineISL || !doseBarISL) {
                console.error("ISL Simulator elements not found. Activity section might not be visible on init.");
                return;
            }

            if(refDoseDisplayISL) refDoseDisplayISL.textContent = I1_SIM.toFixed(1);
            if(refDistDisplayISL) refDistDisplayISL.textContent = d1_SIM.toFixed(1);

            distanceSliderISL.addEventListener('input', updateISLSimulatorVisuals);
            setTimeout(updateISLSimulatorVisuals, 100); 
            window.addEventListener('resize', updateISLSimulatorVisuals);
        }
    </script>
</body>
</html>
